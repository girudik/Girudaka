<p align="center">
  <img src="https://imgur.com/pqlzbHv" alt="Instant 0chan"/>
</p>

# Instant 0chan
Лучше использовать [витчечухан](https://github.com/lainchan/lainchan).

## TODO
- [ ] Разделить логику борды на Н-Х-Ц (MVC)
- - [ ] Все запросы к бд - отдельно
- - [ ] Всю логику - отдельно
- - [ ] Все шаблоны - отдельно

И пока хватит.
## Функции
* Пользовательские доски (2.0чан) с максимальной свободой действий:
  * Полноценная модерация
  * Кастомные стили для досок
  * Раздельные спамлисты для каждой из досок
  * Автозамена
  * Баннеры
* Исправлены баги Kusaba X
* Добавлены собственные баги
* Главная страница на HTML5 с возможностью кастомизации
* Тач-интерфейс (с превью по клику)
* Подсветка кода
* LaTEX
* Эмбеды Youtube, Vimeo и Coub, не нагружающие страницу
* Баннеры
* Кириллическая протухающая капча с генератором произносимых слов
* Улучшенный парсинг
* Фильтры флуда и спама, детектирующие замену букв
* Дайсы, useragent, катриболы
* Множество улучшений в клиентском и серверном коде
* Полный набор нульчановских досок в комплекте
* Поддержка неограниченного количества вложений в постах

## `config.php`
Файл `config.php` в корневой папке содержит основную конфигурацию, которую нужно выполнить в первую очередь.
Конфигурация же при этом выполняется в `instance-config.php`. Для редактирования настроек из `config.php` необходимо скопировать туда нужные строчки.
* **KU_DBTYPE** `(=mysqli)`: тип базы данных 
* **KU_DBHOST**, **KU_DBDATABASE**, **KU_DBUSERNAME**, **KU_DBPASSWORD**: данные для доступа к БД.
* **KU_NAME**: название сайта.
* **KU_SLOGAN**: слоган сайта.
* **KU_WEBFOLDER**: подпапка кусабы на вашем сайте, если она лежит не в корне. (Например, для http://example.com/board/b KU_WEBFOLDER = `"/board/"`).
* **KU_LIVEUPD_ENA** `(true | false)`: включает/выключает мгновенные обновления. Смотри "Настройка мгновенных обновлений" ниже.
* **KU_CSSVER**, **KU_CSSVER** `(любая строка)`: версии CSS и JS, отдаваемые клиенту. При внесении изменений в CSS или JS, рекомендуется инкрементировать версию и пересобрать все файлы.
* **KU_CAPTCHALIFE** `(число)`: время жизни капчи в секундах.
* **KU_20_BOARDSLIMIT** `(число)`: сколько досок может иметь пользователь 2.0-ча.
* **KU_20_CLOUDTIME** `(strtotime-совместимая строка со знаком минус)`: период времени, за который подсчитываются посты на 2.0 досках при сортировке.
* **KU_USERAGENT_ENABLED**: список досок, на которых работает `##useragent##`
### Дополнительно
* При необходимости добавьте содержимое `UTIL/nginx.snippets.conf` в ваш файл конфигурации хоста nginx.

## Установка
* Убедитесь, что база данных, указанная в конфигурации, создана.
* Убедитесь, что содержимое `instance-config.php.example` скопировано в `instance-config.php` и отредактировано должным образом.
* Скопируйте `install.php`, `install-mysql.php` и `kusaba_freshinstall.mysql.php` из папки `UTIL` в корневую папку.
* Запустите `install.php`. После проверки доступности базы данных вам предложат импортировать данные в базу.
* После дампа базы данных введите логин и пароль администратора.
* Удалите файлы, скопированные из папки `UTIL`.

## Управление 
* Возможно обновление сайта с помощью `git`, если в движок не вносились никакие изменения. Просто запустите `git pull`.
* При обновении движка на новую версию бывает необходимо обновить БД. Смотрите лог коммитов и соответствующие SQL-файлы в папке `UTIL`.
* При изменении CSS или JS файлов рекомендуется инкрементировать `KU_CSSVER` и `KU_JSVER` в файле `config.php` после чего пересобирать все файлы.
* При изменении других файлов, если вы используете Cloudflare, необходимо [вручную удалить файл из кэша](http://blog.cloudflare.com/introducing-single-file-purge). Если вы не уверены, что пользователям отдается свежая версия ресурсов или если что-то пошло не так, очищайте кэш Cloudflare полностью.
### Для пересборки kusaba.new.js:
```bash
cd ./lib/javascript/es6
npm install 
npm audit fix #(если потребует)
npm run-script build
```
